<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL EJERCICIO 3</title>
</head>
<body>
    <p>
       CREATE DATABASE ejercicio3;
USE ejercicio3;
CREATE TABLE libros(
                    ISBN VARCHAR(20) PRIMARY KEY,
                    titulo VARCHAR(40),
                    fechaEdicion DATE,
                    numPrestamos INT
);

CREATE TABLE autores(
                    idAutor VARCHAR(20) PRIMARY KEY,
                    nomAutor VARCHAR(20),
                    estilo VARCHAR(20),
                    nacionalidad VARCHAR(30),
                    fechaNac DATE,
                    numPrestamos INT
);

CREATE TABLE escriben (
                    idAutor VARCHAR(20),
                    ISBN VARCHAR(20),
                    CONSTRAINT escriben_pk PRIMARY KEY (idAutor, ISBN),
                    CONSTRAINT idAutor_fk FOREIGN KEY (idAutor) REFERENCES autores(idAutor),
                    CONSTRAINT escriben_ISBN_fk FOREIGN KEY (ISBN) REFERENCES libros(ISBN)  
);
CREATE TABLE socios(
                    idSocio VARCHAR(20) PRIMARY KEY,
                    nomSoc VARCHAR(20),
                    dirSoc VARCHAR(20),
                    tefno INT,
                    fechaFinSancion DATE,
                    numLibrosLeidos INT
);
CREATE TABLE ejemplares(
                    codigoEjemplar VARCHAR(20) PRIMARY KEY,
                    estadoCons VARCHAR(20),
                    ISBN VARCHAR(20),
                    CONSTRAINT ejemplares_ISBN_fk FOREIGN KEY (ISBN) REFERENCES libros(ISBN),
                    CONSTRAINT check_estado CHECK estadoCons("Excelente","Bueno","Malo")
);


CREATE TABLE prestan(
                    idSocio VARCHAR(20),
                    codigoEjemplar VARCHAR(20),
                    fechaPrestamo DATE,
                    fechaDevolucion DATE,
                    CONSTRAINT prestan_pk PRIMARY KEY(idSocio, codigoEjemplar, fechaPrestamo),
                    CONSTRAINT socio_prestan_fk FOREIGN KEY (idSocio) REFERENCES socios(idSocio),
                    CONSTRAINT codigo_prestan_fk FOREIGN KEY (codigoEjemplar) REFERENCES ejemplares(codigoEjemplar)
);

    </p>
    
</body>
</html>
